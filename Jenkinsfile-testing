pipeline {
    environment {
        NAME = "front-service"
        VERSION = env.GIT_COMMIT.take(7)
        REGISTRY = 'marwenguesmii/angular_nginx'
        REGISTRY_CREDENTIAL = 'dockerhub'
        HELM_REPO = "https://github.com/marwennee/HelmCharts"
        PROJECT_REPO = "https://github.com/marwennee/front-service"
        HELM_FOLDER = "helm-front"
    }
    agent {
        kubernetes {
            yaml '''
                spec:
                    containers:
                        - name: docker
                          image: docker:19.03
                          command:
                            - cat
                          tty: true
                          privileged: true
                          volumeMounts:
                            - name: dockersock
                              mountPath: /var/run/docker.sock
                        - name: helm
                          image: lachlanevenson/k8s-helm:v3.1.1
                          command:
                            - cat
                          tty: true
                    volumes:
                        - name: dockersock
                          hostPath:
                            path: /var/run/docker.sock
                '''
        }
    }

    stages {
        stage('Checkout SCM: PROJECT & HELM'){
            steps {
                withCredentials([gitUsernamePassword(credentialsId: 'github',
                                gitToolName: 'git-tool')]) {
                    sh "git clone ${PROJECT_REPO}"
                    sh "git clone ${HELM_REPO}"
                    sh "ls -l"
                }
            }

        }
        stage('Docker Build') {

            steps {
                container('docker') {
                    sh "docker image ls"
                }
            }
        }

    }
}
